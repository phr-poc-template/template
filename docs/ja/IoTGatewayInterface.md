## IoT Gateway Interface

各デバイスから送られたデータは直接IoTHubに送信されるか、別システムを通じてEventHubsに送信されます。  
IoTHubとEventHubsに送信するときのフォーマットは本サンプルでは同じになっています。

### インタフェース仕様

連携フォーマット
* json

文字コード
* UTF-8

### 項目定義

|     項目     |                  |      | 物理名（英名） |   型   | 必須  |                備考                |
| ------------ | ---------------- | ---- | -------------- | :----: | :---: | ---------------------------------- |
| ユーザID     |                  |      | patient        | 文字列 |   *   |                                    |
| 測定日時     |                  |      | time           |  数値  |   *   | UnixTime(sec)                      |
| デバイス     |                  |      | device         |        |       |                                    |
|              | メーカ           |      | makerCode      | 文字列 |   *   |                                    |
|              | プロダクトコード |      | productCode    | 文字列 |   *   |                                    |
|              | バージョン       |      | version        | 文字列 |   *   |                                    |
|              | シリアル番号     |      | serialId       | 文字列 |       |                                    |
|              | 機器名称         |      | name           | 文字列 |       |                                    |
| バイタル情報 |                  |      | vitals         |        |       | バイタル情報、睡眠情報どちらか必須 |
|              | バイタル識別子   |      | *1             |  配列  |       | 識別子分データが存在する           |
|              |                  | Type | type           | 文字列 |       |                                    |
|              |                  | 単位 | unit           | 文字列 |       |                                    |
|              |                  | 時刻 | time           |  数値  |       | UnixTime(sec)                      |
|              |                  | 値   | value          |  数値  |       |                                    |
| 睡眠情報     |                  |      | sleep          |        |       |                                    |
|              | 状態             |      | state          | 文字列 |       | *2                                 |
|              | モーション       |      | motion         |  数値  |       | -1:計測なし、0:体動あり、 1:なし   |
|              | 時刻             |      | time           |  数値  |       | UnixTime(sec)                      |
|              | 呼吸             |      | vitalRR        |  数値  |       |                                    |
|              | 心拍             |      | vitalHR        |  数値  |       |                                    |

*1バイタルデータの識別子

| 識別子 |    意味    |
| ------ | ---------- |
| BT     | 体温       |
| BPH    | 拡張期血圧 |
| BPL    | 収縮期血圧 |
| PR     | 脈拍       |
| SpO2   | 呼吸       |
| BS     | 血糖値     |
| BH     | 身長       |
| BW     | 体重       |

一般的に血圧計は、拡張期血圧、収縮期血圧、脈拍という3つの値が取得できます。
このように1つの機器で複数のデータが取得できる機器に対応するため、vitalsの下には複数のデータを持つことができるような構造となっています。 

血圧計でデータを取得した場合のサンプル

```json
{
  "patient": "uzresk2",
  "time": 1576130346,
  "device": {
    "makerCode": "XXXXX",
    "productCode": "XX000BLE",
    "version": "1.0.0",
    "serialId": "serialId",
    "name": "BLE 内臓血圧計 XX-000BLE"
  },
  "vitals": {
    "BPH": {
      "type": "BPH",
      "unit": "mmHg",
      "time": 1576130346,
      "value": 121
    },
    "BPL": {
      "type": "BPL",
      "unit": "mmHg",
      "time": 1576130346,
      "value": 81
    },
    "PR": {
      "type": "PR",
      "unit": "bpm",
      "time": 1576130346,
      "value": 54
    }
  }
}
```

*2睡眠の状態

各メーカの機器から取得できる睡眠状態です。

|     値     |         状態          |
| ---------- | --------------------- |
| off        | 離床中                |
| sitting    | 端座位                |
| up         | 起き上がり            |
| wake       | 覚醒/体動（動き出し） |
| endmost    | 最短部寄              |
| lightSleep | 浅い睡眠              |
| sleep      | 睡眠（臥床）          |

